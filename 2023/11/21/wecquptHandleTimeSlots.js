const datas = [{"id":"65e0974ca6c718ffadf7602e","type":1,"type_id":"A04232A2040511003","date":"2024-05-06","week_nums":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,16],"week_num":11,"start_time":"10:15:00","end_time":"11:55:00","time_slots":[3,4],"title":"算法分析与设计C","location":"3111","description":"","data":{"course_id":"A2040511","course_name":"算法分析与设计C","class_id":"A04232A2040511003","class_name":"","teacher_name":"舒禹程","course_type":"","exam_type":"","seat":"","qualification":"","schedule_id":"","lecturer":"","chief_invigilator":"","deputy_invigilators":null}},{"id":"65e0974ca6c718ffadf75f0c","type":1,"type_id":"A04232A2040370001","date":"2024-05-06","week_nums":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16],"week_num":11,"start_time":"19:00:00","end_time":"20:40:00","time_slots":[9,10],"title":"面向对象程序设计-JAVA","location":"3102","description":"","data":{"course_id":"A2040370","course_name":"面向对象程序设计-JAVA","class_id":"A04232A2040370001","class_name":"","teacher_name":"何智光","course_type":"","exam_type":"","seat":"","qualification":"","schedule_id":"","lecturer":"","chief_invigilator":"","deputy_invigilators":null}},{"id":"65e0974ca6c718ffadf75faf","type":1,"type_id":"A04232A2040291001","date":"2024-05-06","week_nums":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16],"week_num":11,"start_time":"14:00:00","end_time":"15:40:00","time_slots":[5,6],"title":"计算机图形学B","location":"3101","description":"","data":{"course_id":"A2040291","course_name":"计算机图形学B","class_id":"A04232A2040291001","class_name":"","teacher_name":"冉智勇","course_type":"","exam_type":"","seat":"","qualification":"","schedule_id":"","lecturer":"","chief_invigilator":"","deputy_invigilators":null}},{"id":"65e0974ca6c718ffadf77fff","type":1,"type_id":"SK04232A2040100003","date":"2024-05-06","week_nums":[7,8,9,10,11,12,13,14],"week_num":11,"start_time":"08:00:00","end_time":"09:40:00","time_slots":[1,2],"title":"数据库原理(双语)","location":"数据科学与大数据技术实验室(综合实验楼B516/B517)","description":"","data":{"course_id":"A2040100","course_name":"数据库原理(双语)","class_id":"SK04232A2040100003","class_name":"","teacher_name":"刘伯红","course_type":"","exam_type":"","seat":"","qualification":"","schedule_id":"","lecturer":"","chief_invigilator":"","deputy_invigilators":null}},{"id":"65e0974da6c718ffadf7e651","type":1,"type_id":"R232A1035120004","date":"2024-05-07","week_nums":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16],"week_num":11,"start_time":"19:00:00","end_time":"20:40:00","time_slots":[9,10],"title":"工程管理与经济决策","location":"3103","description":"","data":{"course_id":"A1035120","course_name":"工程管理与经济决策","class_id":"R232A1035120004","class_name":"","teacher_name":"尹龙","course_type":"","exam_type":"","seat":"","qualification":"","schedule_id":"","lecturer":"","chief_invigilator":"","deputy_invigilators":null}},{"id":"65e0974da6c718ffadf7fe9f","type":1,"type_id":"A04232A2040100001","date":"2024-05-07","week_nums":[1,2,3,4,5,6,7,8,9,10,11,12],"week_num":11,"start_time":"14:00:00","end_time":"15:40:00","time_slots":[5,6],"title":"数据库原理(双语)","location":"3206","description":"","data":{"course_id":"A2040100","course_name":"数据库原理(双语)","class_id":"A04232A2040100001","class_name":"","teacher_name":"马彬","course_type":"","exam_type":"","seat":"","qualification":"","schedule_id":"","lecturer":"","chief_invigilator":"","deputy_invigilators":null}},{"id":"65e0974da6c718ffadf7fdef","type":1,"type_id":"A04232A1100052018","date":"2024-05-07","week_nums":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16],"week_num":11,"start_time":"10:15:00","end_time":"11:55:00","time_slots":[3,4],"title":"毛泽东思想和中国特色社会主义理论体系概论","location":"3401","description":"","data":{"course_id":"A1100052","course_name":"毛泽东思想和中国特色社会主义理论体系概论","class_id":"A04232A1100052018","class_name":"","teacher_name":"程桂龙","course_type":"","exam_type":"","seat":"","qualification":"","schedule_id":"","lecturer":"","chief_invigilator":"","deputy_invigilators":null}},{"id":"65e0974da6c718ffadf81e04","type":1,"type_id":"SK04232A2040060004","date":"2024-05-07","week_nums":[7,8,9,10,11,12,13,14],"week_num":11,"start_time":"16:15:00","end_time":"17:55:00","time_slots":[7,8],"title":"计算机组织与结构","location":"智能终端实验室(综合实验楼B509/B510)","description":"","data":{"course_id":"A2040060","course_name":"计算机组织与结构","class_id":"SK04232A2040060004","class_name":"","teacher_name":"邹洋","course_type":"","exam_type":"","seat":"","qualification":"","schedule_id":"","lecturer":"","chief_invigilator":"","deputy_invigilators":null}},{"id":"65e0974ea6c718ffadf85d6f","type":1,"type_id":"R00232A1050250003","date":"2024-05-08","week_nums":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16],"week_num":11,"start_time":"10:15:00","end_time":"11:55:00","time_slots":[3,4],"title":"科技英语阅读与翻译","location":"4205","description":"","data":{"course_id":"A1050250","course_name":"科技英语阅读与翻译","class_id":"R00232A1050250003","class_name":"","teacher_name":"李可","course_type":"","exam_type":"","seat":"","qualification":"","schedule_id":"","lecturer":"","chief_invigilator":"","deputy_invigilators":null}},{"id":"65e0974fa6c718ffadf8d7f8","type":1,"type_id":"T232A1090022051","date":"2024-05-09","week_nums":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18],"week_num":11,"start_time":"10:15:00","end_time":"11:55:00","time_slots":[3,4],"title":"大学体育2（下）(体育2（下）排球2班\t)","location":"室外灯光篮球场04","description":"","data":{"course_id":"A1090022","course_name":"大学体育2（下）(体育2（下）排球2班\t)","class_id":"T232A1090022051","class_name":"","teacher_name":"王天乐","course_type":"","exam_type":"","seat":"","qualification":"","schedule_id":"","lecturer":"","chief_invigilator":"","deputy_invigilators":null}},{"id":"65e0974fa6c718ffadf91d02","type":1,"type_id":"A04232A2040100001","date":"2024-05-09","week_nums":[1,2,3,4,5,6,7,8,9,10,11,12],"week_num":11,"start_time":"19:00:00","end_time":"20:40:00","time_slots":[9,10],"title":"数据库原理(双语)","location":"3206","description":"","data":{"course_id":"A2040100","course_name":"数据库原理(双语)","class_id":"A04232A2040100001","class_name":"","teacher_name":"马彬","course_type":"","exam_type":"","seat":"","qualification":"","schedule_id":"","lecturer":"","chief_invigilator":"","deputy_invigilators":null}},{"id":"65e09750a6c718ffadf97569","type":1,"type_id":"A04232A1100071011","date":"2024-05-10","week_nums":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16],"week_num":11,"start_time":"14:00:00","end_time":"17:00:00","time_slots":[5,6,7],"title":"习近平新时代中国特色社会主义思想概论","location":"8143","description":"","data":{"course_id":"A1100071","course_name":"习近平新时代中国特色社会主义思想概论","class_id":"A04232A1100071011","class_name":"","teacher_name":"徐强（马院）","course_type":"","exam_type":"","seat":"","qualification":"","schedule_id":"","lecturer":"","chief_invigilator":"","deputy_invigilators":null}},{"id":"65e09750a6c718ffadf9775e","type":1,"type_id":"S04232A2041240005","date":"2024-05-09","week_nums":[11,18],"week_num":11,"start_time":"16:15:00","end_time":"17:55:00","time_slots":[7,8],"title":"程序设计实践","location":"计算机教室（三）(综合实验楼A409/A410)","description":"","data":{"course_id":"A2041240","course_name":"程序设计实践","class_id":"S04232A2041240005","class_name":"","teacher_name":"肖丹","course_type":"","exam_type":"","seat":"","qualification":"","schedule_id":"","lecturer":"","chief_invigilator":"","deputy_invigilators":null}},{"id":"65e09750a6c718ffadf9b40c","type":1,"type_id":"SK04232A2040370001","date":"2024-05-10","week_nums":[3,5,7,9,11,13,15,17],"week_num":11,"start_time":"19:00:00","end_time":"20:40:00","time_slots":[9,10],"title":"面向对象程序设计-JAVA","location":"计算机教室（八）(综合实验楼B411/B412)","description":"","data":{"course_id":"A2040370","course_name":"面向对象程序设计-JAVA","class_id":"SK04232A2040370001","class_name":"","teacher_name":"张林","course_type":"","exam_type":"","seat":"","qualification":"","schedule_id":"","lecturer":"","chief_invigilator":"","deputy_invigilators":null}},{"id":"664095dc93b1d0a4b05045d2","type":4,"type_id":"218587044622533","date":"2024-05-11","week_nums":[11],"week_num":11,"start_time":"10:15","end_time":"14:00","time_slots":[3,4,0],"title":"sdasda","location":"","description":"","data":null},{"id":"664096500517e1f596f32a61","type":4,"type_id":"218587522130117","date":"2024-05-11","week_nums":[11],"week_num":11,"start_time":"08:00","end_time":"11:00","time_slots":[1,2,3],"title":"sasd","location":"","description":"","data":null},{"id":"664098010517e1f596f32a63","type":4,"type_id":"218589295005893","date":"2024-05-09","week_nums":[11],"week_num":11,"start_time":"08:55","end_time":"11:00","time_slots":[2,3],"title":"das","location":"","description":"","data":null}]
const all_array = [1, 2, 3, 4, 0, 5, 6, 7, 8, -1, 9, 10, 11, 12];

function sortData(datas) {
    return datas.sort((item1, item2) => {
        const day1 = new Date(item1.date).getDay();
        const day2 = new Date(item2.date).getDay();
        if (day2 !== day1) {
            return day1 - day2;
        }
        if (item1.type !== item2.type) {
            return item1.type - item2.type
        }
        const indexStart1 = all_array.indexOf(item1.time_slots[0]);
        const indexStart2 = all_array.indexOf(item2.time_slots[0]);
        const indexEnd1 = all_array.indexOf(
            item1.time_slots[item1.time_slots.length - 1],
            );
        const indexEnd2 = all_array.indexOf(
            item2.time_slots[item2.time_slots.length - 1],
            );
        const length1 = indexEnd1 - indexStart1;
        const length2 = indexEnd2 - indexStart2;
        return length2 - length1;
    }).map(item => {
        if (item.range) {
            return item
        }
        const day = new Date(item.date).getDay()
        const start = all_array.indexOf(item.time_slots[0]) + 1
        const end = all_array.indexOf(item.time_slots[item.time_slots.length - 1]) + 1
        
        item.range = [day,start,end]
        return item
    })
}

function getSlice(start,end,time_slots){
    const startSlot = all_array[start - 1]
    const endSlot = all_array[end - 1]
    return time_slots.slice(time_slots.indexOf(startSlot),time_slots.indexOf(endSlot) + 1)
}

let dataSort = sortData(datas)

const temp = {}

for(let index = 0; index < dataSort.length; index++) {
    let insertFlag = false
    const classData = dataSort[index]
    const {range}  = classData
    const [itemDay,indexStart,indexEnd] = range
    if (indexStart === 1) {
        debugger
    }
    Object.keys(temp).forEach((tempKey) => {
        if (insertFlag) {
            return;
        }
        const [itemDay2,indexStart2,indexEnd2] = tempKey.split("-").map(string => parseInt(string))
        if (itemDay2 !== itemDay) {
            return
        }
        const minEnd = Math.min(indexEnd2,indexEnd)
        const maxStart = Math.max(indexStart2, indexStart)
        if (minEnd < maxStart) {
            return 
        }
        if (indexEnd > indexEnd2 && indexStart >= indexStart2) {
            const newClassData = {...classData}
            newClassData.range = [itemDay2,indexEnd2 + 1, indexEnd]
            newClassData.time_slots = getSlice(indexEnd2 + 1,indexEnd,classData.time_slots)
            dataSort.push(newClassData)
            dataSort = sortData(dataSort)
        }

        if (indexStart < indexStart2 && indexEnd <= indexEnd2) {
            const newClassData = {...classData}
            newClassData.range = [itemDay2,indexStart, indexStart2 - 1]
            newClassData.time_slots = getSlice(indexStart,indexStart2 -1,classData.time_slots)
            dataSort.push(newClassData)
            dataSort = sortData(dataSort)
        }
        if (indexStart < indexStart2 && indexEnd2 < indexEnd) {
            const newClassData1 = {...classData}
            const newClassData2 = {...classData}
            newClassData1.range = [itemDay2,indexStart,indexStart2 - 1]
            newClassData1.time_slots = getSlice(indexStart,indexStart2 -1, classData.time_slots)
            newClassData2.range = [itemDay2,indexEnd2 + 1,indexEnd]
            newClassData2.time_slots = getSlice(indexEnd2 + 1,indexEnd, classData.time_slots)
            dataSort.push(newClassData1)
            dataSort.push(newClassData2)
            dataSort = sortData(dataSort)
        }
        
        temp[tempKey].push(classData)
        insertFlag = true

        
        
    })
    
    if (!insertFlag) {
        temp[range.join('-')] = [classData]
    }
    
}

console.log(temp)





